<!DOCTYPE html>
<html class="no-js" itemscope itemtype="http://schema.org/Product">
    <head>
    	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" media="all">
    	<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://d3js.org/queue.v1.min.js"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>
    <style>
		
		.counties {
		  fill: none;
		}
		
		.states {
		  fill: none;
		  stroke: #FFF;
		  stroke-linejoin: round;
		}
		
		path:hover{
			opacity:.9;
		}
		
		.GOP { fill:#BC3939; }
		.dem { fill:#273E7F; }
		.third { fill:#128212; }
		.no-change { fill:rgb(210,200,185); }
		
		#tt {
			width:200px;
			height:auto;
			z-index: 100;
		  position: absolute;
		  line-height: 1;
		  font-weight: bold;
		  padding: 12px;
		  background: rgba(0, 0, 0, 0.8);
		  color: #fff;
		  border-radius: 2px;
		}
		
	</style>	
	</head>
	<body>
		<div id="header">
		</div>
		
		<div id="map">
		<div id="tt"></div>
			
		</div>
		<div id="congress">
			
		</div>
		<div id="content">
			
		</div>		
		
	</body>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <!-- SmartMenus jQuery plugin -->
    
    <script>
    	var integer = d3.format(".0f");
    
    	var width = 960,
		    height = 600;
			
		var stateById = d3.map(),
			GainById = d3.map(),
			GOPGainsById = d3.map(),
			demGainsById = d3.map(),
			thirdGainsById = d3.map(),
			totalSeatsById = d3.map().
			GOPRealSeats = d3.map(),
			demRealSeats = d3.map(),
			GOPSimSeats = d3.map(),
			demSimSeats = d3.map(),
			thirdSimSeats = d3.map();
		
		//adjust this to make it return classes like GOPplus DemPlus
		var colors = function(gain){
			switch(gain){
				case 1 : return "GOP";
					break;
				case 2 : return "dem";
					break;
				case 3 : return "third";
					break;
				case 0 : return "no-change";
			}
		};
		
		var projection = d3.geo.albersUsa()
		    .scale(1280)
		    .translate([width / 2, height / 2]);
		
		var path = d3.geo.path()
		    .projection(projection);
		
		var svg = d3.select("#map").append("svg")
		    .attr("width", width)
		    .attr("height", height);
		
		//tooltip object
		var tooltip = {
			initialize: function(){
				var tt = d3.select("#tt");
				tt.html(function() {
						return '<div class="tooltip-content"></div>';
						
					});
			},
			show: function(){ $("#tt").show();},
			hide: function(){ $("#tt").hide();},
			update: function(d, position){
				d3.select(".tooltip-content").remove();
				var tt = d3.select("#tt");
				var left = position.x, leftOff = 25;
				var top = position.y, topOff = 25;
				var gain, second, third;
				switch(GainById.get(d.id)){
					case 1 : gain = "Republicans would gain " + integer(GOPGainsById.get(d.id)) + " out of " + integer(totalSeatsById.get(d.id)) + " seats";
						break;
					case 2 : gain = "Democrats would gain " + integer(demGainsById.get(d.id)) + " out of " + integer(totalSeatsById.get(d.id)) + " seats";
						break;
					case 3 : gain = "Third Parties would gain " + integer(thirdGainsById.get(d.id)) + " out of " + integer(totalSeatsById.get(d.id)) + " seats";
						break;
					case 0 : gain = "There would be no change";
						break;
				}
				tt.html(function(){
					return '<div class="tooltip-content"><table class="table table-condensed"><tr><th colspan="2"><strong>In a PR system in ' + stateById.get(d.id) + '</strong></th></tr><tr><td>' + gain + '</td></tr></table></div>';
				});
				
				tt.transition()
					.style("left", (left + leftOff) + "px")
					.style("top", (top + topOff) + "px");
				
			}
		};

		queue()
		    .defer(d3.json, "us.json")
		    .defer(d3.tsv, "state_vote_totals2.tsv", function(d) { 
		    	stateById.set(d.id, d.state),
		    	GainById.set(d.id, +d.largest_PR_gain),
		    	GOPGainsById.set(d.id, +d.GOP_PR_gains),
		    	demGainsById.set(d.id, +d.dem_PR_gains),
		    	thirdGainsById.set(d.id, +d.sim_alt_seats),
		    	totalSeatsById.set(d.id, +d.real_seat_total),
		    	GOPRealSeats.set(d.id, +d.real_rep_seats),
		    	demRealSeats.set(d.id, +d.real_dem_seats),
		    	GOPSimSeats.set(d.id, +d.GOP_sim_seats),
		    	demSimSeats.set(d.id, +d.dem_sim_seats),
		    	thirdSimSeats.set(d.id, +d.alt_sim_seats);
		    })
		    .await(ready);
		
		function ready(error, us) {
		  tooltip.initialize();
		  tooltip.hide();
		  
		  svg.append("g")
		      .attr("class", "states")
		    .selectAll("path")
		      .data(topojson.feature(us, us.objects.states).features)
		    .enter().append("path")
		      .attr("class", "state")
		      .attr("class", function(d) { return colors(GainById.get(d.id)); })
		      .attr("d", path)
		      .on("mouseover", function(d, i){
		      		var currentMousePos = this.getBoundingClientRect();
					tooltip.update(d, currentMousePos);
					tooltip.show();
		      })
		      .on("mouseout", tooltip.hide);
				
		}
		
		///Congress Code
		var total_seats = 437;
		var GOP_real = 246;
		var dem_real = 191;
		var third_real = 0;
		
		var GOP_sim = 226;
		var dem_sim = 197;
		var third_sim = 14;
			
		var Congress = [];
			for(i=0; i<57; i++){
				if(typeof(stateById.get(i))!="undefined"){
					var temp_GOP_real_seats = GOPSeatsById.get(i);
					
					
					Congress.push()
				}
			}
			
		
		
		
		d3.select(self.frameElement).style("height", height + "px");
    </script>
</html>