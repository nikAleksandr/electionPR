<!DOCTYPE html>
<html class="no-js" itemscope itemtype="http://schema.org/Product">
    <head>
    	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" media="all">
    	<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://d3js.org/queue.v1.min.js"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>
    <style>
		
		.counties {
		  fill: none;
		}
		
		.states {
		  fill: none;
		  stroke: #FFF;
		  stroke-linejoin: round;
		}
		
		path:hover{
			opacity:.9;
		}
		
		.GOP { fill:#BC3939; }
		.dem { fill:#273E7F; }
		.third { fill:#128212; }
		.no-change { fill:rgb(210,200,185); }
		
		.tooltip {
		  line-height: 1;
		  font-weight: bold;
		  padding: 12px;
		  background: rgba(0, 0, 0, 0.8);
		  color: #fff;
		  border-radius: 2px;
		}
		
	</style>	
	</head>
	<body>
		<div id="header">
			
		</div>
		
		<div id="map">
			
		</div>
		<div id="congress">
			
		</div>
		<div id="content">
			
		</div>		
		
	</body>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <!-- SmartMenus jQuery plugin -->
    
    <script>
    	var width = 960,
		    height = 600;
		
		var stateById = d3.map(),
			GainById = d3.map(),
			GOPById = d3.map(),
			demById = d3.map(),
			totalById = d3.map(),
			GOPDiffById = d3.map();
		
		//adjust this to make it return classes like GOPplus DemPlus
		var colors = function(gain){
			switch(gain){
				case 1 : return "GOP";
					break;
				case 2 : return "dem";
					break;
				case 3 : return "third";
					break;
				case 0 : return "no-change";
			}
		};
		
		var projection = d3.geo.albersUsa()
		    .scale(1280)
		    .translate([width / 2, height / 2]);
		
		var path = d3.geo.path()
		    .projection(projection);
		
		var svg = d3.select("#map").append("svg")
		    .attr("width", width)
		    .attr("height", height);
		
		  //would like to make this into an object with methods such as .show() and .hide() and .update()
		var tooltip = {
			initialize: function(){
				d3.select("svg").append("div")
					.attr("class", "tooltip")
					.html(function() {
						return '<div class="tooltip-content"><strong>' + 'stateNameHere' + '</strong></div>';
					});
			},
			show: function(){ $(".tooltip").show();},
			hide: function(){ $(".tooltip").hide();},
			update: function(d){
				d3.select(".tooltip-content").remove();
				d3.select(".tooltip").html(function(d){
					return '<div class="tooltip-content"><strong>' + stateById[d.id] + '</strong></div>';
				});
			}
		};
		/*
		tooltip???
			.attr('class', 'd3-tip')
			.offset([-10, 0])
			.html(function(d) {
				return "<strong>Frequency:</strong> <span style='color:red'>" + d.GOPById + "</span>";
			})
		*/
		queue()
		    .defer(d3.json, "us.json")
		    .defer(d3.tsv, "state_vote_totals2.tsv", function(d) { 
		    	stateById.set(d.id, d.state),
		    	GainById.set(d.id, +d.largest_PR_gain),
		    	GOPById.set(d.id, +d.rep_vote_total),
		    	demById.set(d.id, +d.dem_vote_total),
		    	totalById.set(d.id, +d.real_vote_total); 
		    })
		    .await(ready);
		
		function ready(error, us) {
		  tooltip.initialize();
		  tooltip.hide();
		  
		  svg.append("g")
		      .attr("class", "states")
		    .selectAll("path")
		      .data(topojson.feature(us, us.objects.states).features)
		    .enter().append("path")
		      .attr("class", "state")
		      .attr("class", function(d) { return colors(GainById.get(d.id)); })
		      .attr("d", path)
		      .on("mouseover", function(d, i){
			      	var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
			    	var event = d3.event;
					tooltip.update(d);
					tooltip.show();
		      })
		      .on("mouseout", tooltip.hide);
			
		}
		
		d3.select(self.frameElement).style("height", height + "px");
    </script>
</html>